#!/bin/sh
# Copyright (C) 2006 OpenWrt.org

[ $# = 0 ] && { echo "  $0 <group>"; exit; }
. /etc/functions.sh
include /lib/network
scan_interfaces

cfg=$1
debug "### ifdown $cfg ###"

config_get proto "$cfg" proto
[ -z "$proto" ] && { echo "interface not found."; exit; }

# kill active ppp daemon and other processes
config_get ifname "$cfg" ifname
pids="$(cat /var/run/${ifname}.pid /var/run/ppp-${cfg}.pid 2>/dev/null)"
for pid in $pids; do 
	[ -d "/proc/$pid" ] && {
		kill $pid
		sleep 1
		[ -d "/proc/$pid" ] && kill -9 $pid
	}
done
rm -f /var/run/${ifname}.pid /var/run/ppp-${cfg}.pid

config_get ifname "$cfg" ifname
config_get device "$cfg" ifname

[ ."$device" != ."$ifname" ] || device=
for dev in $ifname $device; do
	ifconfig "$ifname" 0.0.0.0 down >/dev/null 2>/dev/null
done

config_get iftype "$cfg" type
[ "$iftype" = "bridge" ] && brctl delbr "$ifname" >/dev/null 2>/dev/null

